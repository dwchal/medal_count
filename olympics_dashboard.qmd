---
title: "![](olympic_rings.svg){height=30px} 2026 Winter Olympics Medal Tracker"
subtitle: "Milano Cortina 2026"
format:
  dashboard:
    theme:
      light: [flatly, custom.scss]
      dark: [darkly, custom-dark.scss]
    nav-buttons:
      - icon: github
        href: https://github.com
    orientation: columns
    scrolling: true
---

```{r}
#| label: setup
#| include: false

library(tidyverse)
library(plotly)
library(gt)
library(lubridate)
library(scales)
library(bsicons)
library(htmltools)  # For JS integration

# Plotly dark mode compatible layout defaults
plotly_theme <- list(
  paper_bgcolor = "rgba(0,0,0,0)",
  plot_bgcolor = "rgba(0,0,0,0)",
  font = list(color = "#666"),
  xaxis = list(gridcolor = "rgba(128,128,128,0.2)", zerolinecolor = "rgba(128,128,128,0.3)"),
  yaxis = list(gridcolor = "rgba(128,128,128,0.2)", zerolinecolor = "rgba(128,128,128,0.3)")
)

# Olympics dates
olympics_start <- as.Date("2026-02-06")
olympics_end <- as.Date("2026-02-22")
today <- Sys.Date()

# Calculate days
days_until_start <- as.numeric(olympics_start - today)
days_until_end <- as.numeric(olympics_end - today)
total_days <- as.numeric(olympics_end - olympics_start) + 1

# Olympics status
olympics_started <- today >= olympics_start
olympics_ended <- today > olympics_end
current_day <- ifelse(olympics_started & !olympics_ended,
                      as.numeric(today - olympics_start) + 1,
                      ifelse(olympics_ended, total_days, 0))
```

```{r}
#| label: data
#| include: false

# Total medals available at 2026 Winter Olympics (estimated based on events)
# 116 events planned for Milano Cortina 2026
total_gold <- 116
total_silver <- 116
total_bronze <- 116
total_medals <- total_gold + total_silver + total_bronze

# Historical USA Winter Olympics performance for predictions
usa_history <- tibble(
  year = c(2022, 2018, 2014, 2010, 2006, 2002),
  location = c("Beijing", "PyeongChang", "Sochi", "Vancouver", "Turin", "Salt Lake City"),
  gold = c(8, 9, 9, 9, 9, 10),
  silver = c(10, 8, 7, 15, 9, 13),
  bronze = c(7, 6, 12, 13, 7, 11),
  total = c(25, 23, 28, 37, 25, 34)
)

# Prediction model - weighted average with recent games weighted more
weights <- c(0.30, 0.25, 0.20, 0.12, 0.08, 0.05)
predicted_gold <- round(sum(usa_history$gold * weights))
predicted_silver <- round(sum(usa_history$silver * weights))
predicted_bronze <- round(sum(usa_history$bronze * weights))
predicted_total <- predicted_gold + predicted_silver + predicted_bronze

# Prediction intervals (based on historical variance)
gold_sd <- sd(usa_history$gold)
silver_sd <- sd(usa_history$silver)
bronze_sd <- sd(usa_history$bronze)

# 90% prediction intervals
gold_low <- max(0, round(predicted_gold - 1.645 * gold_sd))
gold_high <- round(predicted_gold + 1.645 * gold_sd)
silver_low <- max(0, round(predicted_silver - 1.645 * silver_sd))
silver_high <- round(predicted_silver + 1.645 * silver_sd)
bronze_low <- max(0, round(predicted_bronze - 1.645 * bronze_sd))
bronze_high <- round(predicted_bronze + 1.645 * bronze_sd)

# Current USA medal count (simulated - in production, fetch from API)
# This would be updated from a live data source
if (olympics_started & !olympics_ended) {
  # Simulate some progress based on current day
  progress_pct <- current_day / total_days
  set.seed(2026)  # For reproducibility
  usa_current_gold <- min(round(predicted_gold * progress_pct * runif(1, 0.8, 1.2)), predicted_gold)
  usa_current_silver <- min(round(predicted_silver * progress_pct * runif(1, 0.8, 1.2)), predicted_silver)
  usa_current_bronze <- min(round(predicted_bronze * progress_pct * runif(1, 0.8, 1.2)), predicted_bronze)
} else if (olympics_ended) {
  usa_current_gold <- predicted_gold
  usa_current_silver <- predicted_silver
  usa_current_bronze <- predicted_bronze
} else {
  usa_current_gold <- 0
  usa_current_silver <- 0
  usa_current_bronze <- 0
}
usa_current_total <- usa_current_gold + usa_current_silver + usa_current_bronze

# Events by sport (2026 Winter Olympics)
events_by_sport <- tibble(
  sport = c("Alpine Skiing", "Biathlon", "Bobsled", "Cross-Country Skiing",
            "Curling", "Figure Skating", "Freestyle Skiing", "Ice Hockey",
            "Luge", "Nordic Combined", "Short Track", "Skeleton",
            "Ski Jumping", "Snowboard", "Speed Skating"),
  events = c(11, 11, 4, 12, 3, 5, 13, 2, 4, 3, 9, 2, 5, 11, 14),
  usa_strength = c("Medium", "Low", "High", "Low", "Medium", "High",
                   "High", "High", "Medium", "Low", "Medium", "High",
                   "Low", "High", "Medium")
)

# Schedule of upcoming events (sample)
event_schedule <- tibble(
  date = as.Date(c("2026-02-06", "2026-02-06", "2026-02-07", "2026-02-07",
                   "2026-02-08", "2026-02-08", "2026-02-09", "2026-02-09",
                   "2026-02-10", "2026-02-10", "2026-02-11", "2026-02-11",
                   "2026-02-12", "2026-02-12", "2026-02-13", "2026-02-13")),
  time = c("10:00", "14:00", "09:00", "15:00", "10:00", "14:30", "11:00", "16:00",
           "09:30", "14:00", "10:00", "15:30", "09:00", "14:00", "10:30", "15:00"),
  sport = c("Curling", "Figure Skating", "Biathlon", "Speed Skating",
            "Alpine Skiing", "Luge", "Ski Jumping", "Snowboard",
            "Cross-Country Skiing", "Short Track", "Bobsled", "Freestyle Skiing",
            "Ice Hockey", "Figure Skating", "Alpine Skiing", "Biathlon"),
  event = c("Mixed Doubles Round Robin", "Team Event Qualifying",
            "Mixed Relay", "5000m Men",
            "Downhill Men", "Men's Singles Run 1-2",
            "Normal Hill Individual", "Slopestyle Women Qualifying",
            "Skiathlon Women", "500m Heats",
            "Two-Man Run 1", "Moguls Women",
            "Women's Preliminary", "Team Event Final",
            "Downhill Women", "Individual Women"),
  medals = c(FALSE, FALSE, TRUE, TRUE, TRUE, FALSE, TRUE, FALSE,
             TRUE, FALSE, FALSE, TRUE, FALSE, TRUE, TRUE, TRUE),
  usa_contender = c(TRUE, TRUE, FALSE, TRUE, TRUE, TRUE, FALSE, TRUE,
                    FALSE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, FALSE)
)

# Filter to upcoming events
upcoming_events <- event_schedule %>%
  filter(date >= today) %>%
  arrange(date, time) %>%
  head(12)

# Medal standings (simulated top countries)
# Before Olympics start, all countries have 0 medals
if (olympics_started) {
  # During/after Olympics - show simulated progress
  standings_progress_pct <- current_day / total_days
  set.seed(2026)
  medal_standings <- tibble(
    country = c("Norway", "Germany", "USA", "Canada", "Netherlands",
                "Sweden", "Austria", "Switzerland", "Italy", "France"),
    flag = c("ðŸ‡³ðŸ‡´", "ðŸ‡©ðŸ‡ª", "ðŸ‡ºðŸ‡¸", "ðŸ‡¨ðŸ‡¦", "ðŸ‡³ðŸ‡±", "ðŸ‡¸ðŸ‡ª", "ðŸ‡¦ðŸ‡¹", "ðŸ‡¨ðŸ‡­", "ðŸ‡®ðŸ‡¹", "ðŸ‡«ðŸ‡·"),
    # Predicted totals for each country (based on historical performance)
    pred_gold = c(16, 12, predicted_gold, 8, 8, 8, 7, 6, 5, 5),
    pred_silver = c(10, 10, predicted_silver, 10, 7, 6, 8, 6, 5, 5),
    pred_bronze = c(12, 8, predicted_bronze, 10, 6, 8, 6, 7, 6, 6)
  ) %>%
    rowwise() %>%
    mutate(
      gold = round(pred_gold * standings_progress_pct * runif(1, 0.7, 1.1)),
      silver = round(pred_silver * standings_progress_pct * runif(1, 0.7, 1.1)),
      bronze = round(pred_bronze * standings_progress_pct * runif(1, 0.7, 1.1))
    ) %>%
    ungroup() %>%
    # Override USA with actual tracked values
    mutate(
      gold = ifelse(country == "USA", usa_current_gold, gold),
      silver = ifelse(country == "USA", usa_current_silver, silver),
      bronze = ifelse(country == "USA", usa_current_bronze, bronze)
    ) %>%
    mutate(total = gold + silver + bronze) %>%
    arrange(desc(total), desc(gold), desc(silver)) %>%
    mutate(rank = row_number()) %>%
    select(rank, country, flag, gold, silver, bronze, total)
} else {
  # Before Olympics - all countries have 0 medals
  medal_standings <- tibble(
    rank = 1:10,
    country = c("Norway", "Germany", "USA", "Canada", "Netherlands",
                "Sweden", "Austria", "Switzerland", "Italy", "France"),
    flag = c("ðŸ‡³ðŸ‡´", "ðŸ‡©ðŸ‡ª", "ðŸ‡ºðŸ‡¸", "ðŸ‡¨ðŸ‡¦", "ðŸ‡³ðŸ‡±", "ðŸ‡¸ðŸ‡ª", "ðŸ‡¦ðŸ‡¹", "ðŸ‡¨ðŸ‡­", "ðŸ‡®ðŸ‡¹", "ðŸ‡«ðŸ‡·"),
    gold = rep(0, 10),
    silver = rep(0, 10),
    bronze = rep(0, 10),
    total = rep(0, 10)
  )
}

# Medals awarded so far (simulated)
if (olympics_started) {
  medals_awarded_gold <- round(total_gold * (current_day / total_days) * 0.9)
  medals_awarded_silver <- medals_awarded_gold
  medals_awarded_bronze <- medals_awarded_gold
} else {
  medals_awarded_gold <- 0
  medals_awarded_silver <- 0
  medals_awarded_bronze <- 0
}
medals_awarded_total <- medals_awarded_gold + medals_awarded_silver + medals_awarded_bronze
medals_remaining <- total_medals - medals_awarded_total

# ============================================
# ADVANCED PREDICTIVE ANALYTICS
# ============================================

# Monte Carlo Simulation for USA Medal Predictions
set.seed(42)
n_simulations <- 10000

mc_gold <- rnorm(n_simulations, mean = predicted_gold, sd = gold_sd)
mc_silver <- rnorm(n_simulations, mean = predicted_silver, sd = silver_sd)
mc_bronze <- rnorm(n_simulations, mean = predicted_bronze, sd = bronze_sd)
mc_total <- mc_gold + mc_silver + mc_bronze

# Ensure non-negative values
mc_gold <- pmax(0, round(mc_gold))
mc_silver <- pmax(0, round(mc_silver))
mc_bronze <- pmax(0, round(mc_bronze))
mc_total <- mc_gold + mc_silver + mc_bronze

# Create distribution data for plotting
mc_results <- tibble(
  simulation = 1:n_simulations,
  gold = mc_gold,
  silver = mc_silver,
  bronze = mc_bronze,
  total = mc_total
)

# Probability thresholds for USA
prob_25_plus <- mean(mc_total >= 25) * 100
prob_30_plus <- mean(mc_total >= 30) * 100
prob_35_plus <- mean(mc_total >= 35) * 100
prob_top_3 <- 65  # Historical estimate for top 3 finish

# Sport-by-sport predictions with confidence
sport_predictions <- events_by_sport %>%
  mutate(
    # Base medal probability by strength
    gold_prob = case_when(
      usa_strength == "High" ~ 0.15,
      usa_strength == "Medium" ~ 0.08,
      usa_strength == "Low" ~ 0.03
    ),
    silver_prob = case_when(
      usa_strength == "High" ~ 0.12,
      usa_strength == "Medium" ~ 0.07,
      usa_strength == "Low" ~ 0.04
    ),
    bronze_prob = case_when(
      usa_strength == "High" ~ 0.10,
      usa_strength == "Medium" ~ 0.06,
      usa_strength == "Low" ~ 0.05
    ),
    # Expected medals
    exp_gold = round(events * gold_prob, 1),
    exp_silver = round(events * silver_prob, 1),
    exp_bronze = round(events * bronze_prob, 1),
    exp_total = exp_gold + exp_silver + exp_bronze,
    # Confidence level
    confidence = case_when(
      usa_strength == "High" ~ "High",
      usa_strength == "Medium" ~ "Medium",
      usa_strength == "Low" ~ "Low"
    )
  ) %>%
  arrange(desc(exp_total))

# Country predictions comparison (based on historical data)
country_predictions <- tibble(
  country = c("Norway", "Germany", "USA", "Canada", "Netherlands",
              "Sweden", "Austria", "Switzerland", "Italy", "France",
              "China", "Japan", "South Korea"),
  flag = c("ðŸ‡³ðŸ‡´", "ðŸ‡©ðŸ‡ª", "ðŸ‡ºðŸ‡¸", "ðŸ‡¨ðŸ‡¦", "ðŸ‡³ðŸ‡±", "ðŸ‡¸ðŸ‡ª", "ðŸ‡¦ðŸ‡¹", "ðŸ‡¨ðŸ‡­", "ðŸ‡®ðŸ‡¹", "ðŸ‡«ðŸ‡·",
           "ðŸ‡¨ðŸ‡³", "ðŸ‡¯ðŸ‡µ", "ðŸ‡°ðŸ‡·"),
  pred_gold = c(16, 12, predicted_gold, 8, 8, 8, 7, 6, 5, 5, 6, 4, 3),
  pred_silver = c(10, 10, predicted_silver, 10, 7, 6, 8, 6, 5, 5, 5, 5, 4),
  pred_bronze = c(12, 8, predicted_bronze, 10, 6, 8, 6, 7, 6, 6, 4, 6, 5),
  hist_avg_total = c(39, 31, 29, 29, 22, 18, 21, 18, 15, 15, 15, 13, 11)
) %>%
  mutate(
    pred_total = pred_gold + pred_silver + pred_bronze,
    trend = case_when(
      pred_total > hist_avg_total * 1.1 ~ "â†‘ Up",
      pred_total < hist_avg_total * 0.9 ~ "â†“ Down",
      TRUE ~ "â†’ Stable"
    )
  ) %>%
  arrange(desc(pred_total))

# Daily medal pace analysis
daily_pace_needed <- if (olympics_started & !olympics_ended) {
  remaining_days <- total_days - current_day
  medals_needed <- predicted_total - usa_current_total
  if (remaining_days > 0) round(medals_needed / remaining_days, 1) else 0
} else if (!olympics_started) {
  round(predicted_total / total_days, 1)
} else {
  0
}

# Historical pace comparison
historical_pace <- usa_history %>%
  mutate(pace = round(total / total_days, 1)) %>%
  summarise(
    avg_pace = round(mean(pace), 1),
    best_pace = max(pace),
    worst_pace = min(pace)
  )

# Medal timing predictions (which days medals are most likely)
medal_timing <- tibble(
  day = 1:17,
  date = seq(olympics_start, olympics_end, by = "day"),
  scheduled_events = c(4, 7, 10, 8, 10, 7, 9, 11, 6, 7, 8, 5, 7, 4, 5, 6, 2),
  usa_medal_prob = c(0.3, 0.5, 0.7, 0.6, 0.8, 0.6, 0.7, 0.8, 0.5, 0.6, 0.7, 0.4, 0.5, 0.3, 0.4, 0.5, 0.2),
  expected_usa_medals = round(scheduled_events * usa_medal_prob * 0.25, 1)
) %>%
  mutate(
    cumulative_expected = cumsum(expected_usa_medals),
    date_label = format(date, "%b %d")
  )

# Key USA athletes/events to watch (sample data)
usa_medal_opportunities <- tibble(
  event = c("Women's Snowboard Halfpipe", "Men's Freestyle Ski Slopestyle",
            "Women's Figure Skating", "Men's Bobsled", "Women's Alpine Combined",
            "Mixed Team Figure Skating", "Men's Snowboard Slopestyle",
            "Women's Skeleton", "Men's Short Track 1500m", "Women's Ice Hockey"),
  sport = c("Snowboard", "Freestyle Skiing", "Figure Skating", "Bobsled",
            "Alpine Skiing", "Figure Skating", "Snowboard", "Skeleton",
            "Short Track", "Ice Hockey"),
  date = as.Date(c("2026-02-14", "2026-02-13", "2026-02-20", "2026-02-16",
                   "2026-02-17", "2026-02-07", "2026-02-08", "2026-02-14",
                   "2026-02-12", "2026-02-20")),
  medal_probability = c(0.75, 0.70, 0.65, 0.60, 0.55, 0.80, 0.65, 0.55, 0.40, 0.50),
  expected_medal = c("Gold/Silver", "Gold/Silver", "Gold/Silver/Bronze", "Gold/Silver",
                     "Silver/Bronze", "Gold", "Gold/Silver", "Silver/Bronze",
                     "Bronze", "Gold/Silver")
) %>%
  arrange(date)

# Regression model for total medal prediction
# Using historical data to predict 2026
usa_trend_model <- lm(total ~ year, data = usa_history)
trend_prediction <- predict(usa_trend_model, newdata = tibble(year = 2026))
trend_prediction_rounded <- round(trend_prediction)

# Calculate if USA is on pace (during Olympics)
on_pace_status <- if (olympics_started & !olympics_ended) {
  expected_at_this_point <- predicted_total * (current_day / total_days)
  if (usa_current_total >= expected_at_this_point) "On Track" else "Behind Pace"
} else {
  "Not Started"
}

# ============================================
# MEDAL EFFICIENCY DATA
# ============================================

# Population in millions and GDP in billions USD for top winter Olympic nations
country_efficiency <- tibble(
  country = c("Norway", "Germany", "USA", "Canada", "Netherlands",
              "Sweden", "Austria", "Switzerland", "Italy", "France",
              "China", "Japan", "South Korea"),
  flag = c("\U0001F1F3\U0001F1F4", "\U0001F1E9\U0001F1EA", "\U0001F1FA\U0001F1F8",
           "\U0001F1E8\U0001F1E6", "\U0001F1F3\U0001F1F1", "\U0001F1F8\U0001F1EA",
           "\U0001F1E6\U0001F1F9", "\U0001F1E8\U0001F1ED", "\U0001F1EE\U0001F1F9",
           "\U0001F1EB\U0001F1F7", "\U0001F1E8\U0001F1F3", "\U0001F1EF\U0001F1F5",
           "\U0001F1F0\U0001F1F7"),
  population_m = c(5.5, 84.5, 335, 40, 17.8,
                   10.5, 9.1, 8.9, 59, 68,
                   1412, 124, 52),
  gdp_b = c(580, 4430, 28780, 2140, 1090,
            590, 515, 870, 2190, 2920,
            17790, 4230, 1710),
  pred_total = c(38, 30, predicted_total, 28, 21,
                 22, 21, 19, 16, 16,
                 15, 15, 12),
  winter_athletes = c(110, 150, 225, 215, 40,
                      120, 105, 165, 110, 105,
                      175, 125, 65)
) %>%
  mutate(
    medals_per_million = round(pred_total / population_m, 2),
    medals_per_100b_gdp = round(pred_total / (gdp_b / 100), 2),
    medals_per_athlete = round(pred_total / winter_athletes, 2)
  ) %>%
  arrange(desc(medals_per_million))

# ============================================
# RECORDS & MILESTONES DATA
# ============================================

winter_records <- tibble(
  Record = c(
    "Most gold medals (single Games)",
    "Most total medals (single Games)",
    "Most gold medals (all-time)",
    "Most total medals (all-time)",
    "Youngest Winter Olympic gold medalist",
    "Oldest Winter Olympic gold medalist",
    "Most decorated Winter Olympian",
    "Most medals in a single sport (all-time)",
    "Largest Winter Olympics",
    "Most nations at a Winter Olympics"
  ),
  Holder = c(
    "Norway (Beijing 2022)",
    "Norway (Beijing 2022)",
    "Norway",
    "Norway",
    "Kim Yuna (South Korea, 2010)",
    "Ole Einar Bjorndalen (Norway, 2014)",
    "Marit Bjorgen (Norway)",
    "Marit Bjorgen (Cross-Country)",
    "PyeongChang 2018",
    "PyeongChang 2018"
  ),
  Value = c(
    "16 golds",
    "39 medals",
    "148 golds",
    "405 medals",
    "Age 19",
    "Age 40",
    "15 medals (8G, 4S, 3B)",
    "15 medals",
    "2,920 athletes",
    "92 nations"
  ),
  Category = c(
    "Country", "Country", "Country", "Country",
    "Individual", "Individual", "Individual", "Individual",
    "Games", "Games"
  )
)

usa_milestones <- tibble(
  Milestone = c(
    "USA all-time Winter Olympic golds",
    "USA all-time Winter Olympic medals",
    "Most USA golds (single Games)",
    "Most USA medals (single Games)",
    "USA best Winter Olympics rank",
    "Most decorated USA Winter Olympian",
    "USA consecutive medal Games streak"
  ),
  Detail = c(
    "113 gold medals (through 2022)",
    "330 total medals (through 2022)",
    "13 golds (Salt Lake City 2002, home advantage)",
    "37 medals (Vancouver 2010)",
    "2nd overall (multiple Games)",
    "Apolo Ohno - 8 medals (2S, 0S, 6B) in Short Track",
    "24 consecutive Winter Games with medals (1924-2022)"
  )
)

# ============================================
# WHAT-IF SCENARIO DATA
# ============================================

# Generate what-if scenario outcomes
whatif_scenarios <- tibble(
  scenario = c(
    "Base Prediction",
    "Strong Snowboard/Freestyle",
    "Ice Hockey Double Gold",
    "Figure Skating Sweep",
    "Weak Alpine Performance",
    "Best Case (all strengths hit)",
    "Worst Case (all strengths miss)"
  ),
  gold_adj = c(0, 2, 2, 1, -2, 4, -4),
  silver_adj = c(0, 1, 0, 2, -1, 3, -3),
  bronze_adj = c(0, 1, 0, 1, -1, 3, -3),
  likelihood = c("Baseline", "Medium", "Low", "Low", "Medium", "Very Low", "Very Low")
) %>%
  mutate(
    total_gold = predicted_gold + gold_adj,
    total_silver = predicted_silver + silver_adj,
    total_bronze = predicted_bronze + bronze_adj,
    total_medals = total_gold + total_silver + total_bronze,
    vs_baseline = total_medals - predicted_total
  )
```

```{=html}
<script>
// Dark mode support for Plotly charts and GT tables
(function() {
  function isDarkMode() {
    return document.documentElement.getAttribute('data-bs-theme') === 'dark' ||
           document.body.classList.contains('quarto-dark');
  }

  function getThemeColors() {
    const dark = isDarkMode();
    return {
      fontColor: dark ? '#c0c0c0' : '#444444',
      gridColor: dark ? 'rgba(128,128,128,0.2)' : 'rgba(128,128,128,0.15)',
      zerolineColor: dark ? 'rgba(128,128,128,0.3)' : 'rgba(128,128,128,0.2)',
      legendColor: dark ? '#d0d0d0' : '#444444'
    };
  }

  function updatePlotlyCharts() {
    const colors = getThemeColors();
    const plots = document.querySelectorAll('.js-plotly-plot');

    plots.forEach(function(plot) {
      if (plot && plot.data) {
        try {
          Plotly.relayout(plot, {
            'font.color': colors.fontColor,
            'xaxis.gridcolor': colors.gridColor,
            'yaxis.gridcolor': colors.gridColor,
            'xaxis.zerolinecolor': colors.zerolineColor,
            'yaxis.zerolinecolor': colors.zerolineColor,
            'legend.font.color': colors.legendColor,
            'paper_bgcolor': 'rgba(0,0,0,0)',
            'plot_bgcolor': 'rgba(0,0,0,0)'
          });
        } catch(e) {
          // Chart may not be fully initialized yet
        }
      }
    });
  }

  // Observe theme changes via data-bs-theme attribute
  var observer = new MutationObserver(function(mutations) {
    mutations.forEach(function(mutation) {
      if (mutation.attributeName === 'data-bs-theme' || mutation.attributeName === 'class') {
        // Small delay to let theme CSS apply first
        setTimeout(updatePlotlyCharts, 100);
      }
    });
  });

  // Start observing once DOM is ready
  document.addEventListener('DOMContentLoaded', function() {
    observer.observe(document.documentElement, { attributes: true });
    observer.observe(document.body, { attributes: true });

    // Initial update after charts render
    setTimeout(updatePlotlyCharts, 500);
  });

  // Also update when page fully loads (charts may render late)
  window.addEventListener('load', function() {
    setTimeout(updatePlotlyCharts, 300);
  });
})();
</script>
```

# Overview

## Column {width=25%}

### Row {height=25%}

```{r}
#| content: valuebox
#| title: "Days Until Olympics"
#| icon: calendar-event
#| color: primary
list(
  value = ifelse(days_until_start > 0, days_until_start,
                 ifelse(olympics_ended, "Ended", paste("Day", current_day)))
)
```

### Row {height=25%}

```{r}
#| content: valuebox
#| title: "USA Total Medals"
#| icon: trophy-fill
#| color: info
list(
  value = usa_current_total
)
```

### Row {height=25%}

```{r}
#| content: valuebox
#| title: "Medals Remaining"
#| icon: hourglass-split
#| color: warning
list(
  value = medals_remaining
)
```

### Row {height=25%}

```{r}
#| content: valuebox
#| title: "USA Rank"
#| icon: award-fill
#| color: success

# Before Olympics, show "--" since no one has medals yet
usa_rank <- medal_standings %>% filter(country == "USA") %>% pull(rank)
rank_display <- ifelse(olympics_started, paste("#", usa_rank), "--")

list(
  value = rank_display
)
```

## Column {width=40%}

### Row {height=50%}

```{r}
#| title: "USA Medal Count"
#| padding: 0

usa_medals_df <- tibble(
  Medal = factor(c("Gold", "Silver", "Bronze"), levels = c("Gold", "Silver", "Bronze")),
  Current = c(usa_current_gold, usa_current_silver, usa_current_bronze),
  Predicted = c(predicted_gold, predicted_silver, predicted_bronze),
  `Predicted Low` = c(gold_low, silver_low, bronze_low),
  `Predicted High` = c(gold_high, silver_high, bronze_high)
)

plot_ly() %>%
  add_bars(
    data = usa_medals_df,
    x = ~Medal,
    y = ~Current,
    name = "Current",
    marker = list(color = c("#FFD700", "#C0C0C0", "#CD7F32")),
    text = ~Current,
    textposition = "outside"
  ) %>%
  add_trace(
    data = usa_medals_df,
    x = ~Medal,
    y = ~Predicted,
    type = "scatter",
    mode = "markers",
    name = "Predicted",
    marker = list(
      color = "#0081C8",
      size = 15,
      symbol = "diamond"
    ),
    error_y = list(
      type = "data",
      symmetric = FALSE,
      array = usa_medals_df$`Predicted High` - usa_medals_df$Predicted,
      arrayminus = usa_medals_df$Predicted - usa_medals_df$`Predicted Low`,
      color = "#0081C8"
    )
  ) %>%
  layout(
    title = list(text = ""),
    xaxis = list(title = "", gridcolor = "rgba(128,128,128,0.2)"),
    yaxis = list(title = "Medal Count", range = c(0, max(usa_medals_df$`Predicted High`) + 3),
                 gridcolor = "rgba(128,128,128,0.2)"),
    legend = list(orientation = "h", y = -0.15),
    margin = list(t = 20),
    barmode = "group",
    paper_bgcolor = "rgba(0,0,0,0)",
    plot_bgcolor = "rgba(0,0,0,0)"
  )
```

### Row {height=50%}

```{r}
#| title: "USA Historical Performance"
#| padding: 0

usa_history_long <- usa_history %>%
  pivot_longer(cols = c(gold, silver, bronze), names_to = "medal", values_to = "count") %>%
  mutate(medal = factor(str_to_title(medal), levels = c("Gold", "Silver", "Bronze")))

plot_ly(data = usa_history_long, x = ~year, y = ~count, color = ~medal,
        colors = c("Gold" = "#FFD700", "Silver" = "#C0C0C0", "Bronze" = "#CD7F32"),
        type = "scatter", mode = "lines+markers",
        hovertemplate = "%{x}: %{y} medals<extra>%{fullData.name}</extra>") %>%
  layout(
    title = list(text = ""),
    xaxis = list(title = "Year", tickmode = "array", tickvals = usa_history$year,
                 gridcolor = "rgba(128,128,128,0.2)"),
    yaxis = list(title = "Medals", gridcolor = "rgba(128,128,128,0.2)"),
    legend = list(orientation = "h", y = -0.15),
    margin = list(t = 20),
    hovermode = "x unified",
    paper_bgcolor = "rgba(0,0,0,0)",
    plot_bgcolor = "rgba(0,0,0,0)"
  )
```

## Column {width=35%}

### Row {height=60%}

```{r}
#| title: "Medal Standings"

medal_standings %>%
  mutate(
    Country = paste(flag, country)
  ) %>%
  select(Rank = rank, Country, Gold = gold, Silver = silver, Bronze = bronze, Total = total) %>%
  gt() %>%
  cols_align(align = "center", columns = c(Rank, Gold, Silver, Bronze, Total)) %>%
  cols_align(align = "left", columns = Country) %>%
  tab_style(
    style = cell_fill(color = "#e3f2fd"),
    locations = cells_body(rows = Country == "ðŸ‡ºðŸ‡¸ USA")
  ) %>%
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_body(rows = Country == "ðŸ‡ºðŸ‡¸ USA")
  ) %>%
  cols_width(
    Rank ~ px(50),
    Country ~ px(140),
    Gold ~ px(60),
    Silver ~ px(60),
    Bronze ~ px(60),
    Total ~ px(60)
  ) %>%
  tab_options(
    table.font.size = px(13),
    data_row.padding = px(6)
  )
```

### Row {height=40%}

```{r}
#| title: "Olympics Progress"
#| padding: 0

progress_data <- tibble(
  category = c("Days Elapsed", "Medals Awarded"),
  current = c(current_day, medals_awarded_total),
  total = c(total_days, total_medals),
  pct = c(current_day / total_days * 100, medals_awarded_total / total_medals * 100)
)

plot_ly() %>%
  add_bars(
    data = progress_data,
    y = ~category,
    x = ~pct,
    orientation = "h",
    marker = list(color = c("#2196F3", "#4CAF50")),
    text = ~paste0(round(pct, 1), "%"),
    textposition = "inside",
    hovertemplate = "%{y}: %{x:.1f}%<br>(%{customdata[0]} / %{customdata[1]})<extra></extra>",
    customdata = ~cbind(current, total)
  ) %>%
  layout(
    title = list(text = ""),
    xaxis = list(title = "Percent Complete", range = c(0, 105), ticksuffix = "%",
                 gridcolor = "rgba(128,128,128,0.2)"),
    yaxis = list(title = "", gridcolor = "rgba(128,128,128,0.2)"),
    margin = list(l = 120, t = 20),
    paper_bgcolor = "rgba(0,0,0,0)",
    plot_bgcolor = "rgba(0,0,0,0)"
  )
```

# USA Predictions

## Column {width=50%}

### Row

```{r}
#| title: "Prediction Methodology"
#| padding: 10

cat("## Medal Predictions for Team USA\n\n")
cat("Predictions are based on a **weighted historical average** of the last 6 Winter Olympics:\n\n")
cat("| Olympics | Weight |\n")
cat("|----------|--------|\n")
cat("| 2022 Beijing | 30% |\n")
cat("| 2018 PyeongChang | 25% |\n")
cat("| 2014 Sochi | 20% |\n")
cat("| 2010 Vancouver | 12% |\n")
cat("| 2006 Turin | 8% |\n")
cat("| 2002 Salt Lake City | 5% |\n\n")
cat("The **90% prediction intervals** account for historical variance in performance.\n")
```

### Row

```{r}
#| title: "Detailed Predictions"

tibble(
  Medal = c("ðŸ¥‡ Gold", "ðŸ¥ˆ Silver", "ðŸ¥‰ Bronze", "ðŸ“Š Total"),
  `Predicted` = c(predicted_gold, predicted_silver, predicted_bronze, predicted_total),
  `Low (90% CI)` = c(gold_low, silver_low, bronze_low, gold_low + silver_low + bronze_low),
  `High (90% CI)` = c(gold_high, silver_high, bronze_high, gold_high + silver_high + bronze_high),
  `Current` = c(usa_current_gold, usa_current_silver, usa_current_bronze, usa_current_total),
  `Remaining (Pred)` = c(
    max(0, predicted_gold - usa_current_gold),
    max(0, predicted_silver - usa_current_silver),
    max(0, predicted_bronze - usa_current_bronze),
    max(0, predicted_total - usa_current_total)
  )
) %>%
  gt() %>%
  cols_align(align = "center", columns = -Medal) %>%
  tab_style(
    style = cell_fill(color = "#fff3e0"),
    locations = cells_body(rows = Medal == "ðŸ“Š Total")
  ) %>%
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_body(rows = Medal == "ðŸ“Š Total")
  ) %>%
  tab_options(
    table.font.size = px(14),
    data_row.padding = px(10)
  )
```

## Column {width=50%}

### Row

```{r}
#| title: "USA Strength by Sport"
#| padding: 0

events_strength <- events_by_sport %>%
  mutate(
    strength_num = case_when(
      usa_strength == "High" ~ 3,
      usa_strength == "Medium" ~ 2,
      usa_strength == "Low" ~ 1
    ),
    potential_medals = round(events * strength_num / 3 * 0.3)  # Rough estimate
  ) %>%
  arrange(desc(potential_medals))

plot_ly(data = events_strength,
        x = ~reorder(sport, potential_medals),
        y = ~potential_medals,
        color = ~usa_strength,
        colors = c("High" = "#4CAF50", "Medium" = "#FFC107", "Low" = "#f44336"),
        type = "bar",
        text = ~paste(events, "events"),
        hovertemplate = "%{x}<br>Est. medals: %{y}<br>%{text}<extra></extra>") %>%
  layout(
    title = list(text = ""),
    xaxis = list(title = "", tickangle = 45, gridcolor = "rgba(128,128,128,0.2)"),
    yaxis = list(title = "Estimated Medals", gridcolor = "rgba(128,128,128,0.2)"),
    legend = list(title = list(text = "USA Strength"), orientation = "h", y = 1.1),
    margin = list(b = 120, t = 40),
    showlegend = TRUE,
    paper_bgcolor = "rgba(0,0,0,0)",
    plot_bgcolor = "rgba(0,0,0,0)"
  )
```

### Row

```{r}
#| title: "Events by Sport"

events_by_sport %>%
  arrange(desc(events)) %>%
  mutate(
    `USA Strength` = case_when(
      usa_strength == "High" ~ "ðŸŸ¢ High",
      usa_strength == "Medium" ~ "ðŸŸ¡ Medium",
      usa_strength == "Low" ~ "ðŸ”´ Low"
    )
  ) %>%
  select(Sport = sport, Events = events, `USA Strength`) %>%
  gt() %>%
  cols_align(align = "center", columns = c(Events, `USA Strength`)) %>%
  tab_style(
    style = cell_fill(color = "#e8f5e9"),
    locations = cells_body(rows = `USA Strength` == "ðŸŸ¢ High")
  ) %>%
  tab_options(
    table.font.size = px(13),
    data_row.padding = px(5)
  )
```

# Schedule

## Column {width=55%}

```{r}
#| title: "Upcoming Events"

upcoming_events %>%
  mutate(
    Date = format(date, "%a, %b %d"),
    Time = time,
    `Medal Event` = ifelse(medals, "ðŸ… Yes", ""),
    `USA Contender` = ifelse(usa_contender, "ðŸ‡ºðŸ‡¸ Yes", "")
  ) %>%
  select(Date, Time, Sport = sport, Event = event, `Medal Event`, `USA Contender`) %>%
  gt() %>%
  cols_align(align = "center", columns = c(Time, `Medal Event`, `USA Contender`)) %>%
  tab_style(
    style = cell_fill(color = "#fff8e1"),
    locations = cells_body(rows = `Medal Event` == "ðŸ… Yes")
  ) %>%
  tab_style(
    style = cell_fill(color = "#e3f2fd"),
    locations = cells_body(rows = `USA Contender` == "ðŸ‡ºðŸ‡¸ Yes" & `Medal Event` == "ðŸ… Yes")
  ) %>%
  tab_options(
    table.font.size = px(12),
    data_row.padding = px(6)
  )
```

## Column {width=45%}

### Row {height=40%}

```{r}
#| title: "Key Dates"

key_dates <- tibble(
  Event = c("Opening Ceremony", "First Medal Event", "Closing Ceremony"),
  Date = c("February 6, 2026", "February 6, 2026", "February 22, 2026"),
  Location = c("San Siro Stadium, Milan", "Various Venues", "Verona Arena"),
  Status = c(
    ifelse(today >= as.Date("2026-02-06"), "âœ… Complete", "â³ Upcoming"),
    ifelse(today >= as.Date("2026-02-06"), "âœ… Complete", "â³ Upcoming"),
    ifelse(today >= as.Date("2026-02-22"), "âœ… Complete", "â³ Upcoming")
  )
)

key_dates %>%
  gt() %>%
  cols_align(align = "center", columns = c(Date, Status)) %>%
  tab_options(
    table.font.size = px(14),
    data_row.padding = px(10)
  )
```

### Row {height=60%}

```{r}
#| title: "Medal Events by Day"
#| padding: 0

# Reuse medal_timing data instead of duplicating
medal_events_by_day <- medal_timing %>%
  select(day, date, events = scheduled_events, date_label) %>%
  mutate(
    is_past = date < today,
    is_today = date == today
  )

plot_ly(data = medal_events_by_day,
        x = ~date_label,
        y = ~events,
        type = "bar",
        marker = list(
          color = ~case_when(
            is_past ~ "#90CAF9",
            is_today ~ "#1565C0",
            TRUE ~ "#42A5F5"
          )
        ),
        text = ~events,
        textposition = "outside",
        hovertemplate = "%{x}<br>%{y} medal events<extra></extra>") %>%
  layout(
    title = list(text = ""),
    xaxis = list(title = "", tickangle = 45, gridcolor = "rgba(128,128,128,0.2)"),
    yaxis = list(title = "Medal Events", range = c(0, max(medal_events_by_day$events) + 2),
                 gridcolor = "rgba(128,128,128,0.2)"),
    margin = list(b = 80, t = 20),
    paper_bgcolor = "rgba(0,0,0,0)",
    plot_bgcolor = "rgba(0,0,0,0)"
  )
```

# Analytics

## Column {width=50%}

### Row {height=50%}

```{r}
#| title: "Monte Carlo Simulation: USA Total Medal Distribution"
#| padding: 0

# Create histogram of simulated total medals
plot_ly(x = mc_results$total, type = "histogram",
        marker = list(color = "#3C3B6E", line = list(color = "white", width = 1)),
        nbinsx = 20) %>%
  add_trace(
    x = c(predicted_total, predicted_total),
    y = c(0, n_simulations * 0.15),
    type = "scatter",
    mode = "lines",
    line = list(color = "#B22234", width = 3, dash = "dash"),
    name = paste("Predicted:", predicted_total)
  ) %>%
  add_trace(
    x = c(usa_current_total, usa_current_total),
    y = c(0, n_simulations * 0.15),
    type = "scatter",
    mode = "lines",
    line = list(color = "#FFD700", width = 3),
    name = paste("Current:", usa_current_total),
    visible = ifelse(olympics_started, TRUE, "legendonly")
  ) %>%
  layout(
    title = list(text = ""),
    xaxis = list(title = "Total Medals", gridcolor = "rgba(128,128,128,0.2)"),
    yaxis = list(title = "Frequency (10,000 simulations)", gridcolor = "rgba(128,128,128,0.2)"),
    showlegend = TRUE,
    legend = list(orientation = "h", y = -0.15),
    margin = list(t = 20),
    bargap = 0.05,
    paper_bgcolor = "rgba(0,0,0,0)",
    plot_bgcolor = "rgba(0,0,0,0)"
  )
```

### Row {height=50%}

```{r}
#| title: "USA Medal Probability Thresholds"
#| padding: 0

threshold_data <- tibble(
  threshold = c("20+ medals", "25+ medals", "30+ medals", "35+ medals", "40+ medals"),
  probability = c(
    mean(mc_total >= 20) * 100,
    mean(mc_total >= 25) * 100,
    mean(mc_total >= 30) * 100,
    mean(mc_total >= 35) * 100,
    mean(mc_total >= 40) * 100
  )
) %>%
  mutate(
    color = case_when(
      probability >= 75 ~ "#4CAF50",
      probability >= 50 ~ "#FFC107",
      probability >= 25 ~ "#FF9800",
      TRUE ~ "#f44336"
    )
  )

plot_ly(data = threshold_data,
        x = ~threshold,
        y = ~probability,
        type = "bar",
        marker = list(color = ~color),
        text = ~paste0(round(probability, 1), "%"),
        textposition = "outside") %>%
  layout(
    title = list(text = ""),
    xaxis = list(title = "", categoryorder = "array",
                 categoryarray = c("20+ medals", "25+ medals", "30+ medals", "35+ medals", "40+ medals"),
                 gridcolor = "rgba(128,128,128,0.2)"),
    yaxis = list(title = "Probability (%)", range = c(0, 105),
                 gridcolor = "rgba(128,128,128,0.2)"),
    margin = list(t = 20),
    paper_bgcolor = "rgba(0,0,0,0)",
    plot_bgcolor = "rgba(0,0,0,0)"
  )
```

## Column {width=50%}

### Row {height=50%}

```{r}
#| title: "Predicted Medal Totals by Country"
#| padding: 0

plot_ly(data = country_predictions %>% head(10),
        y = ~reorder(paste(flag, country), pred_total),
        x = ~pred_gold,
        type = "bar",
        orientation = "h",
        name = "Gold",
        marker = list(color = "#FFD700"),
        text = ~pred_gold,
        textposition = "inside") %>%
  add_trace(x = ~pred_silver, name = "Silver",
            marker = list(color = "#C0C0C0"),
            text = ~pred_silver) %>%
  add_trace(x = ~pred_bronze, name = "Bronze",
            marker = list(color = "#CD7F32"),
            text = ~pred_bronze) %>%
  layout(
    title = list(text = ""),
    xaxis = list(title = "Predicted Medals", gridcolor = "rgba(128,128,128,0.2)"),
    yaxis = list(title = "", gridcolor = "rgba(128,128,128,0.2)"),
    barmode = "stack",
    legend = list(orientation = "h", y = -0.1),
    margin = list(l = 100, t = 20),
    paper_bgcolor = "rgba(0,0,0,0)",
    plot_bgcolor = "rgba(0,0,0,0)"
  )
```

### Row {height=50%}

```{r}
#| title: "USA Expected Cumulative Medals Over Time"
#| padding: 0

plot_ly(data = medal_timing,
        x = ~date_label,
        y = ~cumulative_expected,
        type = "scatter",
        mode = "lines+markers",
        name = "Expected Cumulative",
        line = list(color = "#3C3B6E", width = 3),
        marker = list(size = 8)) %>%
  add_trace(
    y = ~expected_usa_medals,
    type = "bar",
    name = "Daily Expected",
    marker = list(color = "rgba(60, 59, 110, 0.3)"),
    yaxis = "y2"
  ) %>%
  layout(
    title = list(text = ""),
    xaxis = list(title = "", tickangle = 45, gridcolor = "rgba(128,128,128,0.2)"),
    yaxis = list(title = "Cumulative Medals", side = "left", gridcolor = "rgba(128,128,128,0.2)"),
    yaxis2 = list(title = "Daily Expected", overlaying = "y", side = "right",
                  gridcolor = "rgba(128,128,128,0.2)"),
    legend = list(orientation = "h", y = 1.1),
    margin = list(b = 80, t = 40),
    paper_bgcolor = "rgba(0,0,0,0)",
    plot_bgcolor = "rgba(0,0,0,0)"
  )
```

### Row {.flow}

```{r}
#| title: "What-If Scenario Analysis for Team USA"

whatif_scenarios %>%
  select(
    Scenario = scenario,
    `Gold` = total_gold,
    `Silver` = total_silver,
    `Bronze` = total_bronze,
    `Total` = total_medals,
    `vs Base` = vs_baseline,
    Likelihood = likelihood
  ) %>%
  gt() %>%
  cols_align(align = "center", columns = -Scenario) %>%
  tab_style(
    style = cell_fill(color = "#e3f2fd"),
    locations = cells_body(rows = Scenario == "Base Prediction")
  ) %>%
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_body(rows = Scenario == "Base Prediction")
  ) %>%
  tab_style(
    style = cell_text(color = "#4CAF50"),
    locations = cells_body(columns = `vs Base`, rows = `vs Base` > 0)
  ) %>%
  tab_style(
    style = cell_text(color = "#f44336"),
    locations = cells_body(columns = `vs Base`, rows = `vs Base` < 0)
  ) %>%
  tab_style(
    style = cell_fill(color = "#e8f5e9"),
    locations = cells_body(rows = Scenario == "Best Case (all strengths hit)")
  ) %>%
  tab_style(
    style = cell_fill(color = "#ffebee"),
    locations = cells_body(rows = Scenario == "Worst Case (all strengths miss)")
  ) %>%
  tab_options(
    table.font.size = px(13),
    data_row.padding = px(6)
  )
```

# Sport Analysis

## Column {width=55%}

### Row

```{r}
#| title: "Sport-by-Sport Medal Predictions"

sport_predictions %>%
  select(Sport = sport, Events = events,
         `ðŸ¥‡ Gold` = exp_gold, `ðŸ¥ˆ Silver` = exp_silver,
         `ðŸ¥‰ Bronze` = exp_bronze, `Total` = exp_total,
         Confidence = confidence) %>%
  gt() %>%
  cols_align(align = "center", columns = -Sport) %>%
  tab_style(
    style = cell_fill(color = "#e8f5e9"),
    locations = cells_body(rows = Confidence == "High")
  ) %>%
  tab_style(
    style = cell_fill(color = "#fff8e1"),
    locations = cells_body(rows = Confidence == "Medium")
  ) %>%
  tab_style(
    style = cell_fill(color = "#ffebee"),
    locations = cells_body(rows = Confidence == "Low")
  ) %>%
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_body(columns = Total)
  ) %>%
  grand_summary_rows(
    columns = c(`ðŸ¥‡ Gold`, `ðŸ¥ˆ Silver`, `ðŸ¥‰ Bronze`, Total),
    fns = list(Total = ~sum(.)),
    fmt = ~fmt_number(., decimals = 1)
  ) %>%
  tab_options(
    table.font.size = px(12),
    data_row.padding = px(5)
  )
```

## Column {width=45%}

### Row {height=55%}

```{r}
#| title: "Top USA Medal Opportunities"

usa_medal_opportunities %>%
  mutate(
    Date = format(date, "%b %d"),
    `Win Prob` = paste0(medal_probability * 100, "%")
  ) %>%
  select(Date, Sport = sport, Event = event, `Win Prob`, `Expected` = expected_medal) %>%
  gt() %>%
  cols_align(align = "center", columns = c(Date, `Win Prob`)) %>%
  tab_style(
    style = cell_fill(color = "#e8f5e9"),
    locations = cells_body(rows = as.numeric(gsub("%", "", `Win Prob`)) >= 60)
  ) %>%
  tab_style(
    style = cell_fill(color = "#fff8e1"),
    locations = cells_body(rows = as.numeric(gsub("%", "", `Win Prob`)) >= 40 &
                                  as.numeric(gsub("%", "", `Win Prob`)) < 60)
  ) %>%
  tab_options(
    table.font.size = px(12),
    data_row.padding = px(5)
  )
```

### Row {height=45%}

```{r}
#| title: "Pace & Trend Analysis"

pace_data <- tibble(
  Metric = c(
    "Predicted Daily Pace",
    "Historical Avg Pace",
    "Best Historical Pace (2010)",
    "Current Status",
    "Trend Model Prediction"
  ),
  Value = c(
    paste(round(predicted_total / total_days, 1), "medals/day"),
    paste(historical_pace$avg_pace, "medals/day"),
    paste(historical_pace$best_pace, "medals/day"),
    on_pace_status,
    paste(trend_prediction_rounded, "total medals")
  ),
  Notes = c(
    "Based on weighted prediction",
    "Average over last 6 Olympics",
    "Vancouver 2010 (37 medals)",
    ifelse(olympics_started, paste("Day", current_day, "of", total_days), "Olympics not started"),
    "Linear regression on historical data"
  )
)

pace_data %>%
  gt() %>%
  cols_align(align = "left") %>%
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_body(columns = Metric)
  ) %>%
  tab_style(
    style = list(
      cell_fill(color = "#e8f5e9"),
      cell_text(weight = "bold")
    ),
    locations = cells_body(rows = Metric == "Current Status" & Value == "On Track")
  ) %>%
  tab_style(
    style = list(
      cell_fill(color = "#ffebee"),
      cell_text(weight = "bold")
    ),
    locations = cells_body(rows = Metric == "Current Status" & Value == "Behind Pace")
  ) %>%
  tab_options(
    table.font.size = px(13),
    data_row.padding = px(8)
  )
```

# Comparison

## Column {width=50%}

### Row

```{r}
#| title: "Country Medal Predictions vs Historical Average"
#| padding: 0

comparison_data <- country_predictions %>%
  head(10) %>%
  pivot_longer(cols = c(pred_total, hist_avg_total),
               names_to = "type", values_to = "medals") %>%
  mutate(type = ifelse(type == "pred_total", "2026 Predicted", "Historical Avg"))

plot_ly(data = comparison_data,
        x = ~reorder(paste(flag, country), -medals),
        y = ~medals,
        color = ~type,
        colors = c("2026 Predicted" = "#3C3B6E", "Historical Avg" = "#B22234"),
        type = "bar",
        text = ~medals,
        textposition = "outside") %>%
  layout(
    title = list(text = ""),
    xaxis = list(title = "", tickangle = 45, gridcolor = "rgba(128,128,128,0.2)"),
    yaxis = list(title = "Total Medals", gridcolor = "rgba(128,128,128,0.2)"),
    barmode = "group",
    legend = list(orientation = "h", y = 1.1),
    margin = list(b = 100, t = 40),
    paper_bgcolor = "rgba(0,0,0,0)",
    plot_bgcolor = "rgba(0,0,0,0)"
  )
```

## Column {width=50%}

### Row {height=50%}

```{r}
#| title: "USA vs Top Competitors"

usa_vs_competitors <- country_predictions %>%
  filter(country %in% c("USA", "Norway", "Germany", "Canada")) %>%
  select(Country = country, Flag = flag,
         `Pred Gold` = pred_gold, `Pred Silver` = pred_silver,
         `Pred Bronze` = pred_bronze, `Pred Total` = pred_total,
         Trend = trend)

usa_vs_competitors %>%
  mutate(Country = paste(Flag, Country)) %>%
  select(-Flag) %>%
  gt() %>%
  cols_align(align = "center", columns = -Country) %>%
  tab_style(
    style = cell_fill(color = "#e3f2fd"),
    locations = cells_body(rows = grepl("USA", Country))
  ) %>%
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_body(rows = grepl("USA", Country))
  ) %>%
  tab_style(
    style = cell_text(color = "#4CAF50"),
    locations = cells_body(columns = Trend, rows = Trend == "â†‘ Up")
  ) %>%
  tab_style(
    style = cell_text(color = "#f44336"),
    locations = cells_body(columns = Trend, rows = Trend == "â†“ Down")
  ) %>%
  tab_options(
    table.font.size = px(14),
    data_row.padding = px(10)
  )
```

### Row {height=50%}

```{r}
#| title: "Medal Distribution Comparison"
#| padding: 0

# Compare medal type distribution across top countries
distribution_data <- country_predictions %>%
  filter(country %in% c("USA", "Norway", "Germany", "Canada")) %>%
  mutate(
    gold_pct = pred_gold / pred_total * 100,
    silver_pct = pred_silver / pred_total * 100,
    bronze_pct = pred_bronze / pred_total * 100
  )

plot_ly(data = distribution_data,
        y = ~paste(flag, country),
        x = ~gold_pct,
        type = "bar",
        orientation = "h",
        name = "Gold %",
        marker = list(color = "#FFD700"),
        text = ~paste0(round(gold_pct), "%"),
        textposition = "inside") %>%
  add_trace(x = ~silver_pct, name = "Silver %",
            marker = list(color = "#C0C0C0"),
            text = ~paste0(round(silver_pct), "%")) %>%
  add_trace(x = ~bronze_pct, name = "Bronze %",
            marker = list(color = "#CD7F32"),
            text = ~paste0(round(bronze_pct), "%")) %>%
  layout(
    title = list(text = ""),
    xaxis = list(title = "Percentage of Total Medals", ticksuffix = "%",
                 gridcolor = "rgba(128,128,128,0.2)"),
    yaxis = list(title = "", gridcolor = "rgba(128,128,128,0.2)"),
    barmode = "stack",
    legend = list(orientation = "h", y = -0.15),
    margin = list(l = 80, t = 20),
    paper_bgcolor = "rgba(0,0,0,0)",
    plot_bgcolor = "rgba(0,0,0,0)"
  )
```

# Efficiency

## Column {width=50%}

### Row {height=55%}

```{r}
#| title: "Medals per Million Population"
#| padding: 0

eff_pop <- country_efficiency %>%
  arrange(desc(medals_per_million)) %>%
  head(10)

plot_ly(data = eff_pop,
        y = ~reorder(paste(flag, country), medals_per_million),
        x = ~medals_per_million,
        type = "bar",
        orientation = "h",
        marker = list(
          color = ~ifelse(country == "USA", "#B22234", "#3C3B6E")
        ),
        text = ~medals_per_million,
        textposition = "outside",
        hovertemplate = "%{y}<br>%{x} medals per million<br>Pop: %{customdata}M<extra></extra>",
        customdata = ~population_m) %>%
  layout(
    title = list(text = ""),
    xaxis = list(title = "Predicted Medals per Million People",
                 gridcolor = "rgba(128,128,128,0.2)"),
    yaxis = list(title = "", gridcolor = "rgba(128,128,128,0.2)"),
    margin = list(l = 100, t = 20),
    paper_bgcolor = "rgba(0,0,0,0)",
    plot_bgcolor = "rgba(0,0,0,0)"
  )
```

### Row {height=45%}

```{r}
#| title: "Medals per $100B GDP"
#| padding: 0

eff_gdp <- country_efficiency %>%
  arrange(desc(medals_per_100b_gdp)) %>%
  head(10)

plot_ly(data = eff_gdp,
        y = ~reorder(paste(flag, country), medals_per_100b_gdp),
        x = ~medals_per_100b_gdp,
        type = "bar",
        orientation = "h",
        marker = list(
          color = ~ifelse(country == "USA", "#B22234", "#0081C8")
        ),
        text = ~medals_per_100b_gdp,
        textposition = "outside",
        hovertemplate = "%{y}<br>%{x} medals per $100B GDP<br>GDP: $%{customdata}B<extra></extra>",
        customdata = ~gdp_b) %>%
  layout(
    title = list(text = ""),
    xaxis = list(title = "Predicted Medals per $100B GDP",
                 gridcolor = "rgba(128,128,128,0.2)"),
    yaxis = list(title = "", gridcolor = "rgba(128,128,128,0.2)"),
    margin = list(l = 100, t = 20),
    paper_bgcolor = "rgba(0,0,0,0)",
    plot_bgcolor = "rgba(0,0,0,0)"
  )
```

## Column {width=50%}

### Row {height=50%}

```{r}
#| title: "Medals per Athlete"
#| padding: 0

eff_athlete <- country_efficiency %>%
  arrange(desc(medals_per_athlete)) %>%
  head(10)

plot_ly(data = eff_athlete,
        y = ~reorder(paste(flag, country), medals_per_athlete),
        x = ~medals_per_athlete,
        type = "bar",
        orientation = "h",
        marker = list(
          color = ~ifelse(country == "USA", "#B22234", "#4CAF50")
        ),
        text = ~medals_per_athlete,
        textposition = "outside",
        hovertemplate = "%{y}<br>%{x} medals per athlete<br>Athletes: %{customdata}<extra></extra>",
        customdata = ~winter_athletes) %>%
  layout(
    title = list(text = ""),
    xaxis = list(title = "Predicted Medals per Athlete Sent",
                 gridcolor = "rgba(128,128,128,0.2)"),
    yaxis = list(title = "", gridcolor = "rgba(128,128,128,0.2)"),
    margin = list(l = 100, t = 20),
    paper_bgcolor = "rgba(0,0,0,0)",
    plot_bgcolor = "rgba(0,0,0,0)"
  )
```

### Row {height=50%}

```{r}
#| title: "Efficiency Rankings"

country_efficiency %>%
  arrange(desc(medals_per_million)) %>%
  mutate(
    Country = paste(flag, country),
    `Pop Rank` = row_number()
  ) %>%
  arrange(desc(medals_per_100b_gdp)) %>%
  mutate(`GDP Rank` = row_number()) %>%
  arrange(desc(medals_per_athlete)) %>%
  mutate(`Athlete Rank` = row_number()) %>%
  mutate(
    `Avg Rank` = round((`Pop Rank` + `GDP Rank` + `Athlete Rank`) / 3, 1)
  ) %>%
  arrange(`Avg Rank`) %>%
  select(Country, `Pred Total` = pred_total,
         `Per 1M Pop` = medals_per_million,
         `Per $100B` = medals_per_100b_gdp,
         `Per Athlete` = medals_per_athlete,
         `Avg Rank`) %>%
  gt() %>%
  cols_align(align = "center", columns = -Country) %>%
  tab_style(
    style = cell_fill(color = "#e3f2fd"),
    locations = cells_body(rows = grepl("USA", Country))
  ) %>%
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_body(rows = grepl("USA", Country))
  ) %>%
  tab_options(
    table.font.size = px(12),
    data_row.padding = px(5)
  )
```

# Records

## Column {width=50%}

```{r}
#| title: "Winter Olympics All-Time Records"

winter_records %>%
  gt() %>%
  cols_align(align = "left") %>%
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_body(columns = Record)
  ) %>%
  tab_style(
    style = cell_fill(color = "#fff8e1"),
    locations = cells_body(rows = Category == "Individual")
  ) %>%
  tab_style(
    style = cell_fill(color = "#e3f2fd"),
    locations = cells_body(rows = Category == "Country")
  ) %>%
  tab_style(
    style = cell_fill(color = "#e8f5e9"),
    locations = cells_body(rows = Category == "Games")
  ) %>%
  tab_options(
    table.font.size = px(13),
    data_row.padding = px(8)
  )
```

## Column {width=50%}

### Row {height=50%}

```{r}
#| title: "USA Winter Olympics Milestones"

usa_milestones %>%
  gt() %>%
  cols_align(align = "left") %>%
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_body(columns = Milestone)
  ) %>%
  tab_options(
    table.font.size = px(13),
    data_row.padding = px(8)
  )
```

### Row {height=50%}

```{r}
#| title: "USA Medal Count by Year"
#| padding: 0

plot_ly(data = usa_history,
        x = ~year,
        y = ~total,
        type = "scatter",
        mode = "lines+markers+text",
        text = ~total,
        textposition = "top center",
        line = list(color = "#3C3B6E", width = 3),
        marker = list(size = 12, color = "#B22234"),
        hovertemplate = "%{x}<br>Total: %{y} medals<extra></extra>") %>%
  add_trace(
    x = 2026,
    y = predicted_total,
    mode = "markers+text",
    text = paste0(predicted_total, " (pred)"),
    textposition = "top center",
    marker = list(size = 14, color = "#FFD700", symbol = "star"),
    name = "2026 Predicted",
    hovertemplate = "2026 Predicted<br>Total: %{y} medals<extra></extra>"
  ) %>%
  layout(
    title = list(text = ""),
    xaxis = list(title = "Year", tickmode = "array",
                 tickvals = c(usa_history$year, 2026),
                 gridcolor = "rgba(128,128,128,0.2)"),
    yaxis = list(title = "Total Medals", gridcolor = "rgba(128,128,128,0.2)"),
    showlegend = FALSE,
    margin = list(t = 30),
    paper_bgcolor = "rgba(0,0,0,0)",
    plot_bgcolor = "rgba(0,0,0,0)"
  )
```

# About

## Column

```{r}
#| title: "About This Dashboard"
#| padding: 15

cat("## 2026 Winter Olympics Medal Tracker\n\n")
cat("### Milano Cortina 2026\n\n")
cat("The **XXV Olympic Winter Games** will be held in Milan and Cortina d'Ampezzo, Italy from **February 6-22, 2026**.\n\n")
cat("### Dashboard Features\n\n")
cat("- **Real-time medal tracking** with live standings\n")
cat("- **Monte Carlo simulations** (10,000 iterations) for probability estimates\n")
cat("- **Sport-by-sport predictions** with confidence levels\n")
cat("- **Pace analysis** comparing current progress to historical trends\n")
cat("- **Country comparisons** with predicted vs historical performance\n")
cat("- **Event schedule** with USA medal opportunities highlighted\n")
cat("- **Medal efficiency analysis** comparing medals per capita, per GDP, and per athlete\n")
cat("- **Records & milestones** for Winter Olympics history and USA achievements\n")
cat("- **What-if scenarios** exploring different outcome paths for Team USA\n")
cat("- **Dark mode toggle** for comfortable viewing in any lighting condition\n\n")
cat("### Predictive Models\n\n")
cat("1. **Weighted Historical Average**: Recent Olympics weighted more heavily\n")
cat("2. **Monte Carlo Simulation**: 10,000 simulations for probability distributions\n")
cat("3. **Linear Trend Model**: Regression on historical medal counts\n")
cat("4. **Sport-Specific Model**: Per-event probabilities based on USA strength\n\n")
cat("### Data Sources\n\n")
cat("- Historical medal data from 2002-2022 Winter Olympics\n")
cat("- Event schedule from official IOC/Milano Cortina 2026 sources\n")
cat("- Country strength ratings based on recent World Cup/Championship results\n\n")
cat(paste0("**Last updated:** ", format(Sys.time(), "%B %d, %Y at %I:%M %p %Z")))
```

## Column

```{r}
#| title: "Olympics at a Glance"

olympics_stats <- tibble(
  Statistic = c(
    "Host Cities",
    "Duration",
    "Total Events",
    "Total Medals Available",
    "Sports",
    "Participating Nations (est.)",
    "Athletes (est.)"
  ),
  Value = c(
    "Milan & Cortina d'Ampezzo, Italy",
    "17 days (Feb 6-22, 2026)",
    "116 events",
    paste0(total_medals, " medals"),
    "15 sports",
    "~90 nations",
    "~2,900 athletes"
  )
)

olympics_stats %>%
  gt() %>%
  cols_align(align = "left") %>%
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_body(columns = Statistic)
  ) %>%
  tab_options(
    table.font.size = px(14),
    data_row.padding = px(12)
  )
```
